# GitHub Secrets Setup - Quick Reference

This document provides a quick checklist for setting up all required GitHub secrets for the Paperless Automation deployment.

## How to Add Secrets

1. Go to your GitHub repository
2. Click **Settings** → **Secrets and variables** → **Actions**
3. Click **New repository secret**
4. Enter the secret name and value
5. Click **Add secret**

---

## Required Secrets Checklist

### ✅ Kubernetes Configuration

- [ ] **KUBE_CONFIG_DATA**
  ```bash
  # Generate from your kubeconfig:
  cat ~/.kube/config | base64 | tr -d '\n'
  ```

### ✅ Application Core Secrets

- [ ] **BETTER_AUTH_SECRET**
  ```bash
  openssl rand -hex 32
  ```

- [ ] **ENCRYPTION_KEY**
  ```bash
  openssl rand -hex 32
  ```

- [ ] **INTERNAL_API_SECRET**
  ```bash
  openssl rand -hex 32
  ```

- [ ] **CRON_SECRET**
  ```bash
  openssl rand -hex 32
  ```

### ✅ Database

- [ ] **POSTGRESQL_PASSWORD**
  ```bash
  # Generate strong password (recommended 32+ characters):
  openssl rand -base64 32
  ```

---

## Optional Secrets

### OAuth Providers

#### Google OAuth

- [ ] **GOOGLE_CLIENT_ID**
  - Get from: https://console.cloud.google.com/apis/credentials
  - OAuth 2.0 Client IDs
  - Redirect URI: `https://paperless.oppulence.app/api/auth/callback/google`

- [ ] **GOOGLE_CLIENT_SECRET**
  - From same Google Cloud Console location

#### GitHub OAuth

- [ ] **GITHUB_CLIENT_ID**
  - Get from: https://github.com/settings/developers
  - OAuth Apps → New OAuth App
  - Callback URL: `https://paperless.oppulence.app/api/auth/callback/github`

- [ ] **GITHUB_CLIENT_SECRET**
  - From same GitHub Developer settings

### AI/LLM Providers

- [ ] **OPENAI_API_KEY**
  - Get from: https://platform.openai.com/api-keys
  - Format: `sk-...`

- [ ] **ANTHROPIC_API_KEY**
  - Get from: https://console.anthropic.com/
  - Format: `sk-ant-...`

### AWS S3 Storage

- [ ] **AWS_ACCESS_KEY_ID**
  - Get from AWS IAM: https://console.aws.amazon.com/iam/
  - Create IAM user with S3 permissions

- [ ] **AWS_SECRET_ACCESS_KEY**
  - From same AWS IAM user creation

- [ ] **S3_BUCKET_NAME**
  - Your S3 bucket name (e.g., `paperless-automation-files`)
  - Ensure bucket exists and IAM user has access

---

## Secrets Summary

### Must Have (Deployment will fail without these)

| Secret | Purpose | Generated By |
|--------|---------|--------------|
| KUBE_CONFIG_DATA | Kubernetes cluster access | Your kubeconfig file (base64) |
| BETTER_AUTH_SECRET | JWT signing | `openssl rand -hex 32` |
| ENCRYPTION_KEY | Data encryption | `openssl rand -hex 32` |
| INTERNAL_API_SECRET | Service auth | `openssl rand -hex 32` |
| CRON_SECRET | Cron job auth | `openssl rand -hex 32` |
| POSTGRESQL_PASSWORD | Database access | `openssl rand -base64 32` |

### Nice to Have (Features won't work without these)

| Secret | Feature Enabled |
|--------|-----------------|
| GOOGLE_CLIENT_ID + GOOGLE_CLIENT_SECRET | Google Sign-In |
| GITHUB_CLIENT_ID + GITHUB_CLIENT_SECRET | GitHub Sign-In |
| OPENAI_API_KEY | OpenAI GPT models |
| ANTHROPIC_API_KEY | Claude AI models |
| AWS_ACCESS_KEY_ID + AWS_SECRET_ACCESS_KEY + S3_BUCKET_NAME | File uploads to S3 |

---

## Example: Setting Up All Core Secrets

```bash
#!/bin/bash
# generate-secrets.sh - Generate all core secrets

echo "=== Generating Core Application Secrets ==="
echo ""

echo "BETTER_AUTH_SECRET:"
openssl rand -hex 32
echo ""

echo "ENCRYPTION_KEY:"
openssl rand -hex 32
echo ""

echo "INTERNAL_API_SECRET:"
openssl rand -hex 32
echo ""

echo "CRON_SECRET:"
openssl rand -hex 32
echo ""

echo "POSTGRESQL_PASSWORD:"
openssl rand -base64 32
echo ""

echo "=== Add these to GitHub Secrets ==="
```

Save this script, run it, and copy each value into GitHub Secrets.

---

## Verification

After adding all secrets, verify:

1. **Count**: Check you have at least 6 secrets (the required ones)
2. **Names**: Ensure spelling matches exactly (case-sensitive)
3. **Values**: No extra spaces or newlines
4. **Kubeconfig**: Verify it's base64-encoded (should be one long string)

### Test Deployment

After setting up secrets:

1. Go to **Actions** tab
2. Click **Deploy to Production**
3. Click **Run workflow**
4. Select `main` branch
5. Check "Force deployment"
6. Click **Run workflow**

Watch the deployment progress. If it fails, check:
- GitHub Actions logs for which secret is missing
- Secret names match exactly
- Kubeconfig is valid base64

---

## Security Notes

⚠️ **Important Security Practices:**

1. **Never share secrets**: Don't post in Slack, email, or commit to git
2. **Store securely**: Use a password manager for the generated secrets
3. **Rotate regularly**: Change secrets every 90 days (except kubeconfig)
4. **Principle of least privilege**: Only grant necessary AWS/GCP permissions
5. **Monitor access**: Review GitHub Actions logs periodically

---

## Troubleshooting

### "Secret not found" error

- Double-check the secret name spelling
- Ensure secret is added at repository level (not environment level)
- Verify secret is not empty

### "Invalid base64" error for KUBE_CONFIG_DATA

```bash
# Make sure to remove newlines:
cat ~/.kube/config | base64 | tr -d '\n' > kubeconfig.b64

# Then copy from file:
cat kubeconfig.b64

# Verify it decodes correctly:
cat kubeconfig.b64 | base64 -d
```

### OAuth not working

- Verify redirect URLs match exactly in OAuth provider settings
- Check client ID and secret are from the same OAuth app
- Ensure domain is accessible (not localhost)

---

## Next Steps

Once all secrets are configured:

1. ✅ Review the [Deployment Guide](DEPLOYMENT.md)
2. ✅ Trigger a test deployment
3. ✅ Verify health checks pass
4. ✅ Test OAuth login flows (if configured)
5. ✅ Set up monitoring and alerts
