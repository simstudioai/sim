# Example: External Secrets Operator Integration
#
# This example shows how to integrate with External Secrets Operator (ESO)
# to automatically sync secrets from external secret management systems.
#
# Prerequisites:
# 1. Install External Secrets Operator in your cluster:
#    helm repo add external-secrets https://charts.external-secrets.io
#    helm install external-secrets external-secrets/external-secrets \
#      -n external-secrets --create-namespace
#
# 2. Create a SecretStore or ClusterSecretStore for your provider.
#    See examples below for Azure Key Vault, AWS Secrets Manager, and HashiCorp Vault.
#
# Documentation: https://external-secrets.io/

# =============================================================================
# EXTERNAL SECRETS OPERATOR CONFIGURATION
# =============================================================================
externalSecrets:
  enabled: true
  apiVersion: "v1"       # Use "v1" for ESO v0.17+ (default), "v1beta1" for older versions
  refreshInterval: "1h"  # How often to sync secrets
  secretStoreRef:
    name: "sim-secret-store"  # Name of your SecretStore/ClusterSecretStore
    kind: "ClusterSecretStore"  # or "SecretStore" for namespace-scoped
  remoteRefs:
    app:
      BETTER_AUTH_SECRET: "sim/app/better-auth-secret"
      ENCRYPTION_KEY: "sim/app/encryption-key"
      INTERNAL_API_SECRET: "sim/app/internal-api-secret"
      CRON_SECRET: "sim/app/cron-secret"
      API_ENCRYPTION_KEY: "sim/app/api-encryption-key"
    postgresql:
      password: "sim/postgresql/password"

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================
app:
  enabled: true
  replicaCount: 2
  env:
    NEXT_PUBLIC_APP_URL: "https://sim.example.com"
    BETTER_AUTH_URL: "https://sim.example.com"
    NEXT_PUBLIC_SOCKET_URL: "wss://sim-ws.example.com"
    NODE_ENV: "production"
    # Note: Sensitive values (BETTER_AUTH_SECRET, ENCRYPTION_KEY, etc.)
    # are injected from External Secrets and don't need to be set here

realtime:
  enabled: true
  replicaCount: 2
  env:
    NEXT_PUBLIC_APP_URL: "https://sim.example.com"
    BETTER_AUTH_URL: "https://sim.example.com"
    NEXT_PUBLIC_SOCKET_URL: "wss://sim-ws.example.com"
    ALLOWED_ORIGINS: "https://sim.example.com"
    NODE_ENV: "production"

postgresql:
  enabled: true
  # Password is injected from External Secrets
  auth:
    username: postgres
    database: sim

# =============================================================================
# EXAMPLE SECRETSTORE CONFIGURATIONS
# =============================================================================
# Below are example SecretStore configurations for popular providers.
# Apply ONE of these to your cluster before installing the Sim chart.

# -----------------------------------------------------------------------------
# Azure Key Vault (with Workload Identity - Recommended)
# -----------------------------------------------------------------------------
# apiVersion: external-secrets.io/v1beta1
# kind: ClusterSecretStore
# metadata:
#   name: sim-secret-store
# spec:
#   provider:
#     azurekv:
#       authType: WorkloadIdentity
#       vaultUrl: "https://your-keyvault-name.vault.azure.net"
#       serviceAccountRef:
#         name: external-secrets-sa
#         namespace: external-secrets

# -----------------------------------------------------------------------------
# Azure Key Vault (with Service Principal)
# -----------------------------------------------------------------------------
# apiVersion: external-secrets.io/v1beta1
# kind: ClusterSecretStore
# metadata:
#   name: sim-secret-store
# spec:
#   provider:
#     azurekv:
#       tenantId: "your-tenant-id"
#       vaultUrl: "https://your-keyvault-name.vault.azure.net"
#       authSecretRef:
#         clientId:
#           name: azure-sp-credentials
#           key: client-id
#           namespace: external-secrets
#         clientSecret:
#           name: azure-sp-credentials
#           key: client-secret
#           namespace: external-secrets

# -----------------------------------------------------------------------------
# AWS Secrets Manager (with IRSA - Recommended)
# -----------------------------------------------------------------------------
# apiVersion: external-secrets.io/v1beta1
# kind: ClusterSecretStore
# metadata:
#   name: sim-secret-store
# spec:
#   provider:
#     aws:
#       service: SecretsManager
#       region: us-east-1
#       role: arn:aws:iam::123456789012:role/external-secrets-role

# -----------------------------------------------------------------------------
# AWS Secrets Manager (with static credentials)
# -----------------------------------------------------------------------------
# apiVersion: external-secrets.io/v1beta1
# kind: ClusterSecretStore
# metadata:
#   name: sim-secret-store
# spec:
#   provider:
#     aws:
#       service: SecretsManager
#       region: us-east-1
#       auth:
#         secretRef:
#           accessKeyIDSecretRef:
#             name: aws-credentials
#             key: access-key-id
#             namespace: external-secrets
#           secretAccessKeySecretRef:
#             name: aws-credentials
#             key: secret-access-key
#             namespace: external-secrets

# -----------------------------------------------------------------------------
# HashiCorp Vault (with Kubernetes Auth - Recommended)
# -----------------------------------------------------------------------------
# apiVersion: external-secrets.io/v1beta1
# kind: ClusterSecretStore
# metadata:
#   name: sim-secret-store
# spec:
#   provider:
#     vault:
#       server: "https://vault.example.com"
#       path: "secret"
#       version: "v2"
#       auth:
#         kubernetes:
#           mountPath: "kubernetes"
#           role: "external-secrets"
#           serviceAccountRef:
#             name: external-secrets-sa
#             namespace: external-secrets

# -----------------------------------------------------------------------------
# Google Cloud Secret Manager (with Workload Identity - Recommended)
# -----------------------------------------------------------------------------
# apiVersion: external-secrets.io/v1beta1
# kind: ClusterSecretStore
# metadata:
#   name: sim-secret-store
# spec:
#   provider:
#     gcpsm:
#       projectID: your-gcp-project-id

# =============================================================================
# SECRETS TO CREATE IN YOUR EXTERNAL SECRET STORE
# =============================================================================
# Create the following secrets in your external store with these paths:
#
# sim/app/better-auth-secret       - 64 char hex string (openssl rand -hex 32)
# sim/app/encryption-key           - 64 char hex string (openssl rand -hex 32)
# sim/app/internal-api-secret      - 64 char hex string (openssl rand -hex 32)
# sim/app/cron-secret              - 64 char hex string (openssl rand -hex 32)
# sim/app/api-encryption-key       - 64 char hex string (openssl rand -hex 32)
# sim/postgresql/password          - Alphanumeric string (openssl rand -base64 16 | tr -d '/+=')
