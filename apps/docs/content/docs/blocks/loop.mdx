---
title: Loop
description: Create iterative workflows with loops that execute blocks repeatedly
---

import { Callout } from 'fumadocs-ui/components/callout'
import { Step, Steps } from 'fumadocs-ui/components/steps'
import { Tab, Tabs } from 'fumadocs-ui/components/tabs'
import { ThemeImage } from '@/components/ui/theme-image'

The Loop block is a container block in Sim Studio that allows you to execute a group of blocks repeatedly. Loops enable iterative processing in your workflows.

<ThemeImage
  lightSrc="/static/light/loop-light.png"
  darkSrc="/static/dark/loop-dark.png"
  alt="Loop Block"
  width={500}
  height={300}
/>

<Callout type="info">
  Loop blocks are container nodes that can hold other blocks inside them. The blocks inside a loop will execute multiple times based on your configuration.
</Callout>

## Overview

The Loop block enables you to:

<Steps>
  <Step>
    <strong>Iterate over collections</strong>: Process arrays or objects one item at a time
  </Step>
  <Step>
    <strong>Repeat operations</strong>: Execute blocks a fixed number of times
  </Step>
</Steps>

## Configuration Options

### Loop Type

Choose between two types of loops:

<Tabs items={['For Loop', 'ForEach Loop']}>
  <Tab>
    A numeric loop that executes a fixed number of times. Use this when you need to repeat an operation a specific number of times.
    
    ```
    Example: Run 5 times
    - Iteration 1
    - Iteration 2
    - Iteration 3
    - Iteration 4
    - Iteration 5
    ```
  </Tab>
  <Tab>
    A collection-based loop that iterates over each item in an array or object. Use this when you need to process a collection of items.
    
    ```
    Example: Process ["apple", "banana", "orange"]
    - Iteration 1: Process "apple"
    - Iteration 2: Process "banana"
    - Iteration 3: Process "orange"
    ```
  </Tab>
</Tabs>

## How to Use Loops

### Creating a Loop

1. Drag a Loop block from the toolbar onto your canvas
2. Configure the loop type and parameters
3. Drag other blocks inside the loop container
4. Connect the blocks as needed

### Accessing Results

After a loop completes, you can access aggregated results:

- **`<loop.results>`**: Array of results from all loop iterations

## Example Use Cases

### Processing API Results

<div className="mb-4 rounded-md border p-4">
  <h4 className="font-medium">Scenario: Process multiple customer records</h4>
  <ol className="list-decimal pl-5 text-sm">
    <li>API block fetches customer list</li>
    <li>ForEach loop iterates over each customer</li>
    <li>Inside loop: Agent analyzes customer data</li>
    <li>Inside loop: Function stores analysis results</li>
  </ol>
</div>

### Iterative Content Generation

<div className="mb-4 rounded-md border p-4">
  <h4 className="font-medium">Scenario: Generate multiple variations</h4>
  <ol className="list-decimal pl-5 text-sm">
    <li>Set For loop to 5 iterations</li>
    <li>Inside loop: Agent generates content variation</li>
    <li>Inside loop: Evaluator scores the content</li>
    <li>After loop: Function selects best variation</li>
  </ol>
</div>

## Advanced Features

### Limitations

<Callout type="warning">
  Container blocks (Loops and Parallels) cannot be nested inside each other. This means:
  - You cannot place a Loop block inside another Loop block
  - You cannot place a Parallel block inside a Loop block
  - You cannot place any container block inside another container block
  
  If you need multi-dimensional iteration, consider restructuring your workflow to use sequential loops or process data in stages.
</Callout>

<Callout type="info">
  Loops execute sequentially, not in parallel. If you need concurrent execution, use the Parallel block instead.
</Callout>

## Inputs and Outputs

<Tabs items={['Configuration', 'Variables', 'Results']}>
  <Tab>
    <ul className="list-disc space-y-2 pl-6">
      <li>
        <strong>Loop Type</strong>: Choose between 'for' or 'forEach'
      </li>
      <li>
        <strong>Iterations</strong>: Number of times to execute (for loops)
      </li>
      <li>
        <strong>Collection</strong>: Array or object to iterate over (forEach loops)
      </li>
    </ul>
  </Tab>
  <Tab>
    <ul className="list-disc space-y-2 pl-6">
      <li>
        <strong>loop.currentItem</strong>: Current item being processed
      </li>
      <li>
        <strong>loop.index</strong>: Current iteration number (0-based)
      </li>
      <li>
        <strong>loop.items</strong>: Full collection (forEach loops)
      </li>
    </ul>
  </Tab>
  <Tab>
    <ul className="list-disc space-y-2 pl-6">
      <li>
        <strong>loop.results</strong>: Array of all iteration results
      </li>
      <li>
        <strong>Structure</strong>: Results maintain iteration order
      </li>
      <li>
        <strong>Access</strong>: Available in blocks after the loop
      </li>
    </ul>
  </Tab>
</Tabs>

## Best Practices

- **Set reasonable limits**: Keep iteration counts reasonable to avoid long execution times
- **Use ForEach for collections**: When processing arrays or objects, use ForEach instead of For loops
- **Handle errors gracefully**: Consider adding error handling inside loops for robust workflows

## YAML Schema

### Schema Definition

```yaml
type: object
required:
  - type
  - name
  - inputs
  - connections
properties:
  type:
    type: string
    enum: [loop]
    description: Block type identifier
  name:
    type: string
    description: Display name for this loop block
  inputs:
    type: object
    required:
      - count
      - loopType
    properties:
      count:
        type: number
        description: Number of iterations for 'for' loops
        minimum: 1
      loopType:
        type: string
        enum: [for, forEach]
        description: Type of loop to execute
      collection:
        type: string
        description: Array or object to iterate over (forEach loops only)
  connections:
    type: object
    required:
      - loop
    properties:
      loop:
        type: object
        required:
          - start
        properties:
          start:
            type: string
            description: Target block ID to execute within the loop
          end:
            type: string
            description: Target block ID to execute after the loop completes (optional)
```

### Child Block Configuration

Blocks executed within a loop must:
1. **Stem from the loop's `start` field** - The loop's `connections.loop.start` points to the first block inside the loop
2. **Include a `parentId` reference** to the actual loop block ID

```yaml
process-items:
  type: loop
  name: "Process Items"
  connections:
    loop:
      start: item-processor  # This block must be inside the loop
      end: summary-agent     # This block runs after the loop

item-processor:
  type: agent
  name: "Item Processor"
  inputs:
    # Block-specific inputs
    # Can access loop variables like <loop.index>, <loop.currentItem>
  parentId: process-items  # Must reference the loop block ID
```

### Loop Variables

Inside loop blocks, you can access these special variables:

- **`<loop.index>`**: Current iteration number (0-based)
- **`<loop.currentItem>`**: Current item being processed (forEach loops only)
- **`<loop.items>`**: Full collection (forEach loops only)

### Referencing Loop Output

After a loop completes, you can reference its results using the loop block name (lowercase, no spaces):

- Loop name "Process Items" → reference as `<processitems.results>`
- Loop name "Data Processing" → reference as `<dataprocessing.results>`

```yaml
process-items:
  type: loop
  name: "Process Items"
  # ... loop configuration

summary-agent:
  type: agent
  name: "Summary Agent"  
  inputs:
    userPrompt: "Summarize these results: <processitems.results>"
```

### Examples

<Tabs items={['Complete Loop Flow', 'ForEach Array', 'Nested Data']}>
  <Tab>
    ```yaml
    setup-agent:
      type: agent
      name: "Setup Agent"
      inputs:
        systemPrompt: "Create a simple JSON array of 3-5 items to process."
        userPrompt: "Create a list of items for me to process in a loop"
        model: gpt-4o
        apiKey: '{{OPENAI_API_KEY}}'
      connections:
        success: process-items
    
    process-items:
      type: loop
      name: "Process Items"
      inputs:
        count: 1
      connections:
        loop:
          start: item-processor
          end: summary-agent
    
    item-processor:
      type: agent
      name: "Item Processor"
      inputs:
        systemPrompt: "Process items one by one. Provide a fun fact about each item."
        userPrompt: "Tell me something interesting about: <setupagent.content>"
        model: gpt-4o
        temperature: 0.8
        apiKey: '{{OPENAI_API_KEY}}'
      parentId: process-items
    
    summary-agent:
      type: agent
      name: "Summary Agent"
      inputs:
        systemPrompt: "Summarize the results"
        userPrompt: "Summarize these results: <processitems.results>"
        model: gpt-4o
        apiKey: '{{OPENAI_API_KEY}}'
    ```
  </Tab>
  <Tab>
    ```yaml
    process-items:
      type: loop
      name: "Process Array Items"
      inputs:
        loopType: forEach
        collection: <start.product_list>
      connections:
        loop:
          start: item-processor
    
    item-processor:
      type: function
      name: "Item Processor"
      inputs:
        code: |
          // Process each item in the array
          const currentItem = <loop.currentItem>;
          const itemIndex = <loop.index>;
          
          return {
            index: itemIndex,
            name: currentItem.name,
            processed: true,
            timestamp: new Date().toISOString()
          };
      parentId: process-items
    ```
  </Tab>
  <Tab>
    ```yaml
    data-enrichment:
      type: loop
      name: "Enrich Customer Data"
      inputs:
        loopType: forEach
        collection: <start.customers>
      connections:
        loop:
          start: lookup-agent
    
    lookup-agent:
      type: agent
      name: "Customer Lookup"
      inputs:
        systemPrompt: "Look up additional information for this customer."
        userPrompt: "Find additional details for customer: <loop.currentItem.name> with ID: <loop.currentItem.id>"
        model: gpt-4o
        apiKey: '{{OPENAI_API_KEY}}'
        tools:
          - type: exa
            title: "Web Search"
            toolId: exa_search
            operation: exa_search
            params:
              apiKey: '{{EXA_API_KEY}}'
      parentId: data-enrichment
    ```
  </Tab>
</Tabs> 